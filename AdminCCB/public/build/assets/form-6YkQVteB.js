let y,L;E();C();document.addEventListener("DOMContentLoaded",r=>{});function C(){const r=document.querySelector("#follow"),l=document.querySelector("#nombre"),a=document.querySelector("#cedula"),s=document.querySelector("#telefono"),d=document.querySelector("#email");document.querySelector("#confemail");const p=document.querySelectorAll(".valAprovText"),g=document.querySelectorAll(".valAprovNum"),m=document.querySelectorAll('input[name="first"'),v=document.querySelectorAll('input[name="second"');document.querySelector("#tyc");let n=!1,o=!1,u=!1;p.forEach(function(e){e.addEventListener("input",function(i){var c=e.value,S=/^[a-zA-Z-á-é-í-ó-ú ]*$/;S.test(c)||(e.value=e.value.replace(/[^a-zA-Z-á-é-í-ó-ú ]/g,""))})}),g.forEach(function(e){e.addEventListener("input",function(i){var c=e.value,S=/^[0-9]*$/;S.test(c)||(e.value=e.value.replace(/[^0-9]/g,""))})}),r&&r.addEventListener("click",e=>{e.preventDefault(),n=!1,o=!1,u=!1;const i=document.querySelectorAll(".valid1"),c=document.querySelectorAll(".valid2"),S=document.querySelector("#pass"),b=document.querySelector("#passInf"),T=document.querySelector("#passFam");let q,h;const M=Number(b.value)+Number(T.value);let x=!1,I=!1;if(l.value==""||a.valid==""?(i.forEach(function(t){t.value.trim()==""?t.classList.add("err"):t.classList.remove("err")}),f("Los campos con (*) son obligatorios")):n=!0,b.value==""||T.value==""?c.forEach(function(t){t.value.trim()==""?t.classList.add("err"):t.classList.remove("err")}):M>S.innerHTML?f("La cantidad de pasaportes infantil y familiar no coinciden con la cantidad total"):o=!0,m.forEach(function(t){t.checked&&(x=!0,q=t.value)}),v.forEach(function(t){t.checked&&(I=!0,h=t.value)}),x&&I?u=!0:f("Los campos con (*) son obligatorios"),n&&o&&u){const t=y.innerText+L.innerHTML;r.setAttribute("disabled","true"),localStorage.setItem("5baa61e4",y.innerHTML),localStorage.setItem("7f83b1657ff1fc53",L.innerHTML),localStorage.setItem("5baa61e4werg",a.value),H(ixi.innerText,T.value,b.value,l.value,a.value,y.innerText,s.value,d.value,t,q,h)}});function f(e){const i=document.querySelector(".msnModal"),c=i.closest(".modalvalid");c.classList.add("show"),i.innerHTML=e,setTimeout(()=>{c.classList.remove("show")},2e3)}}function E(){const r=localStorage.getItem("5baa61e4"),l=localStorage.getItem("7f83b1657ff1fc53"),a=document.querySelector(".nm"),s=document.querySelector(".cc"),d=document.querySelector(".rs"),p=document.querySelector(".cp"),g=document.querySelector(".ixi"),m=document.querySelector(".boxInfantil__content"),v=document.querySelector(".boxFamiliar__content");y=a,L=s,r&&l?fetch(`/api/afiliado/${r}/${l}`).then(n=>n.json()).then(n=>{const o=n.afiliados,u=n.infantilTipo1,f=u.VALOR.split(", "),e=n.familairTipo2,i=e.VALOR.split(", ");m.innerHTML="",v.innerHTML="",n.status&&(a.innerText=o.Matricula,s.innerText=o.CodigoCCB,d.innerText=o.RazonSocial,p.innerText=o.CantidadPasaportes,g.innerText=o.Id_Afiliado,A(u,f,m,"passInf"),A(e,i,v,"passFam"))}):window.location.href="/"}function A(r,l,a,s){a.innerHTML+=`
        <div class="boxInfantil__content--single"><strong>${r.NOMBRE}</strong></div>
    `,l.forEach(d=>{a.innerHTML+=`
            <div class="boxInfantil__content--single">${d}</div>
        `}),a.innerHTML+=`
        <div class="boxInfantil__content--single">Cant. pasaporte <input type="number" class="valAprovNum valid2" id="${s}"></div>
    `}function H(r,l,a,s,d,p,g,m,v,n,o){new FormData;const u={Id_Afiliados:4,CantidadFamiliar:l,CantidadInfantil:a,test:s,Documento:d,Matricula:p,Celular:g,Email:m,CodigoRedencion:v,Utilidad:n,Hogar:o},f=document.querySelector('meta[name="csrf-token"]').getAttribute("content");$.ajax({url:"/api/guardarInscritos",method:"POST",data:u,haders:{"Content-type":"application/json","X-CSRF-TOKEN":f},success:function(e){console.log("Datos enviados correctamente",e),e.message==="Registro creado correctamente"?window.location.href="/pdf":window.location.href="/"},error:function(e,i,c){console.error("Error al enviar datos:",c)}})}
