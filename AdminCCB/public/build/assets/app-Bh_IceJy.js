let i;document.addEventListener("DOMContentLoaded",e=>{f(),h()});function f(){var e=document.getElementById("canvasTrack"),t=e&&e.getContext("2d"),a=new Image;a.src="../img/mundo.png",t&&(a.onload=function(){t.drawImage(a,0,0,e.width,e.height),t.font="20px Arial",t.fillStyle="black",i=g(),t.fillText(i,25,50)})}function g(){for(var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",t=8,a="",n=0;n<t;n++)a+=e.charAt(Math.floor(Math.random()*e.length));return a}function h(){const e=document.querySelector("#submit"),t=document.querySelector("#codTrack"),a=document.querySelector("#matricula"),n=document.querySelector("#CCB"),l=document.querySelector(".msnError"),d=document.querySelectorAll(".inputValidate"),u=document.querySelector(".modalRegister"),s=document.querySelector(".modalRegister__content--btn");s&&s.addEventListener("click",r=>{window.location.reload()}),d.forEach(function(r){r.addEventListener("input",function(o){var m=r.value,v=/^[a-zA-Z0-9]*$/;v.test(m)||(r.value=r.value.replace(/[^a-zA-Z0-9]/g,""),l.textContent="No se permiten caracteres especiales",c("No se permiten caracteres especiales",!0))})}),e&&e.addEventListener("click",r=>{r.preventDefault(),a.value==""||n.value==""||t.value==""?c("Los campos con (*) son obligatorios",!0):a.value.length>15||n.value.length>15?c("Los campos de matricula y codigo deben ser de maximo 15 caracteres",!0):t.value.length<8?c("El campo de código de seguridad debe tener 8 caracteres",!0):t.value!==i?(console.log(t.value,i),c("Código de seguridad incorrecto",!1)):(e.setAttribute("disabled","true"),fetch(`/api/afiliado/${a.value}/${n.value}`).then(o=>o.json()).then(o=>{console.log(o),o.afiliados==="No se encontró ningún registro con esos parámetros"&&u.classList.add("show"),o.status&&(localStorage.setItem("5baa61e4",a.value),localStorage.setItem("7f83b1657ff1fc53",n.value),window.location.href="/form")}).catch(o=>{console.error("Error:",o)}))});function c(r,o){l.textContent=r,l.classList.add("active"),setTimeout(()=>{l.classList.remove("active"),o||setTimeout(()=>{location.reload()},2e3)},3500)}}
